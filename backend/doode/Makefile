# Makefile for Spring Boot + Gradle + Docker Compose project
# Author: Holy Ike
# Description:
#   Automates building a Spring Boot app and managing Docker containers safely.

# Commands
GRADLE = ./gradlew
DOCKER_COMPOSE = docker-compose
DC_FILE = compose.yaml

# Default target
all: up

# Helper: check if docker-compose.yml exists
check-docker:
	@if [ ! -f $(DC_FILE) ]; then \
		echo "âŒ Error: $(DC_FILE) not found in the current directory."; \
		echo "   Please make sure Docker Compose configuration exists."; \
		exit 1; \
	fi

# ğŸ§© Build Spring Boot app and rebuild/start Docker containers
up: check-docker
	@echo "ğŸš€ Building Spring Boot app and restarting Docker containers..."
	$(GRADLE) build -x test && $(DOCKER_COMPOSE) down && $(DOCKER_COMPOSE) up --build -d
	@echo "âœ… Application built and containers are running."

# ğŸ§± Build the app (no Docker)
build:
	@echo "ğŸ”§ Building Spring Boot app..."
	$(GRADLE) clean build -x test
	@echo "âœ… Build complete."

# ğŸ³ Start containers (no rebuild)
start: check-docker
	@echo "â–¶ï¸ Starting Docker containers..."
	$(DOCKER_COMPOSE) up -d
	@echo "âœ… Containers started."

# ğŸ›‘ Stop containers
stop: check-docker
	@echo "â¹ï¸ Stopping Docker containers..."
	$(DOCKER_COMPOSE) down
	@echo "âœ… Containers stopped."

# ğŸ§¼ Clean Gradle build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build files..."
	$(GRADLE) clean
	@echo "âœ… Clean complete."

# ğŸ§­ Show Docker container status
status: check-docker
	@$(DOCKER_COMPOSE) ps
